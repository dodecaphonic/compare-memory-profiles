# compare-memory-profiles

Allows comparisons between two Ruby memory profiles generated by [memory_profiler](https://github.com/SamSaffron/memory_profiler).

## Usage

```sh
$ compare-memory-profiles --help
compare-memory-profiles - Compares two Ruby memory_profiler dumps

Usage: compare-memory-profiles (-a|--profileA PROFILEA)
                               (-b|--profileB PROFILEB) [-A|--only-in-a] 
                               [-B|--only-in-b] [-D|--allocation-diff PCT]
  Compare two Ruby memory_profiler dumps and apply useful filters

Available options:
  -a,--profileA PROFILEA   Profile A (shown at the left in comparisons)
  -b,--profileB PROFILEB   Profile B (shown at the right in comparisons)
  -A,--only-in-a           Show allocations only present in profile A
  -B,--only-in-b           Show allocations only present in profile B
  -D,--allocation-diff PCT Only show allocations differing PCT between A and B
  -h,--help                Show this help text
```

Example (keeping only allocations that have a 25%+ difference between A and B):

```sh
$ compare-memory-profiles -a memory_profile_development.log -b memory_profile_production.log -D 25
"retained memory by class"
-----------------------------------
      7938497       16170920    String

"retained memory by file"
-----------------------------------
         1194        8193051    [REDACTED]/vendor/gems/ruby/2.7.0/gems/activerecord-6.0.3.6/lib/active_record/connection_adapters/postgresql_adapter.rb

"retained memory by gem"
-----------------------------------
       489665        8706384    activerecord-6.0.3.6

"retained objects by class"
-----------------------------------
         1164           1672    Hash

"retained objects by file"
-----------------------------------
           21             71    [REDACTED]/vendor/gems/ruby/2.7.0/gems/activerecord-6.0.3.6/lib/active_record/connection_adapters/postgresql_adapter.rb

"retained objects by location"
-----------------------------------
           36             19    [REDACTED]/vendor/gems/ruby/2.7.0/gems/zeitwerk-2.4.2/lib/zeitwerk/loader.rb:645
```
